<ion-header [translucent]="true">
  <ion-toolbar style="padding-left:10px;padding-right:10px;">
    <ion-buttons slot="start">
      <ion-back-button style="width:50px;height:50px;" 
        defaultHref="" (click)="ui.goback()" [text]="''">
      </ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ ui.instant('Tracker.StudyActivityCount') }}<!--动态-->
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <app-shi-tracker [year]="currentViewDate.getFullYear()" 
  [showActivity]="true"
  (monthSelected)="onMonthSelected($event)"></app-shi-tracker>

  <div class="calendar-wrapper">
    <div class="calendar-container" #calendarContainer>
      <!-- Header -->
      <div class="calendar-header">
        <div *ngFor="let day of weekDays" class="weekday-label">{{ day }}</div>
      </div>
      
      <!-- Grid -->
      <div class="calendar-grid">
        <div *ngFor="let day of calendarDays" class="calendar-cell" 
             [ngClass]="{
               'today': day.isToday,
               'future': day.isFuture && day.isCurrentMonth,
               'past-current': day.isCurrentMonth && !day.isToday && !day.isFuture,
               'other-month': !day.isCurrentMonth,
               'has-data': day.trackerValue > 0
             }"
             [style.background-color]="day.bgColor"
             (click)="openDetails(day)">
           <div class="day-content">
             <div class="day-number">{{ day.day }}</div>
             <div class="dot" [style.visibility]="day.trackerValue > 0 ? 'visible' : 'hidden'" [style.background-color]="day.color"></div>
           </div>
        </div>
      </div>
    
      <!-- Footer -->
      <div class="calendar-footer">
        <div class="current-month-indicator" (click)="resetMonth()">
           <ion-icon name="calendar-outline"></ion-icon>
           <span style="margin-left:5px;">{{ displayMonth }} {{ displayYear }}</span>
        </div>
        
        <div class="nav-buttons">
          <ion-button fill="clear" (click)="prevMonth()">
            <ion-icon slot="icon-only" name="chevron-back-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" (click)="nextMonth()" [disabled]="!canGoNext()">
            <ion-icon slot="icon-only" name="chevron-forward-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>
  </div>


  <ion-modal id="tracker-details-modal" #detailsModal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false"
    [enterAnimation]="enterAnimation" [leaveAnimation]="leaveAnimation">
    <ng-template>
      <div class="wrapper" style="max-height: 80vh; display: flex; flex-direction: column; background: var(--ion-background-color, #ffffff); border-radius: 8px; overflow: hidden;">
        
        <!-- Header -->
        <div style="padding: 0px 10px 10px 20px; flex-shrink: 0; background: var(--ion-background-color, #ffffff); z-index: 10; display: flex; justify-content: space-between; align-items: center;">
          <h1 style="margin: 0; font-size: 20px; font-weight: bold;">
            {{ ui.instant('Tracker.Details') }} 
            <span [style.fontSize]="dataService.zoom(15)" style="font-weight: normal; color: black;">
              {{ selectedDateStr }}
            </span>
          </h1>
          <ion-button fill="clear" (click)="isModalOpen = false" style="margin-right: -10px;">
            <ion-icon name="close-circle-outline" style="font-size: 24px; color: var(--ion-color-medium);"></ion-icon>
          </ion-button>
        </div>
        
        <!-- Scrollable Content -->
        <div style="flex: 1; overflow-y: auto; padding: 0 20px;">
          <ion-list lines="none">
            <ion-item *ngFor="let item of selectedDateDetails" detail="false" style="--padding-start: 0;">
              <ion-label>
                 <div style="display: flex; flex-direction: column; gap: 4px;">
                    <div style="font-size: 12px; color: var(--ion-color-medium);">{{ item.displayTime }}</div>
                    <div style="font-weight: 500;">
                      {{ ui.instant('Log.' + item.name) }}
                    </div>
                    <div style="font-size: 14px; color: var(--ion-text-color-step-150); white-space: normal;">
                      {{ item.content }}
                    </div>
                 </div>
              </ion-label>
            </ion-item>
            <div *ngIf="selectedDateDetails.length === 0" style="text-align: center; color: var(--ion-color-medium); padding: 20px;">
               {{ ui.instant('Log.NoDetailsAvailable') }}
            </div>
          </ion-list>
          
          <div style="margin-top: 20px; text-align: right; padding-bottom: 20px;">
               <ion-button fill="clear" (click)="isModalOpen = false">{{ ui.instant('Action.Close') }}</ion-button>
          </div>
        </div>

      </div>
    </ng-template>
  </ion-modal>

  <div class="placeholder-playbox"></div>
</ion-content>
